# 第1レイヤー（カーネル言語）仕様書

## 1. 設計方針 (Design Principles)

* **単純性 (Simplicity):** 言語仕様を最小限に留め、実装者が容易に構築できるものとする。
* **単値性 (Single-value):** すべての式は単一の値のみを返す。多値（Multiple values）のサポートはこのレイヤーには含めない。
* **静的安定性:** カーネルレベルでの動的な再定義（実行中の関数定義の書き換え等）は原則サポートしない、もしくは最小限に留める。

## 2. 必須機能 (Core Features)

### 2.1 制御構造 (Control Flow)

* **関数呼び出し:** 引数を評価し、関数へ適用する基本的な仕組み。
* **条件分岐:**
* `if`: 最も基本的な条件分岐。
* （オプション）`cond`, `and`, `or`: `if`とマクロで実装可能だが、プリミティブとして提供するかは実装コストと相談。


* **逐次実行:** `progn` 相当の機能（複数の式を順に評価し、最後の値を返す）。

### 2.2 データ構造 (Basic Data Structures)

Common Lispの基礎となる以下のデータ型をサポートする。

* **アトム (Atoms):**
* シンボル (Symbols): 値、関数、プロパティリスト（plist）の保持。
* 数値 (Numbers): 少なくとも整数（Integer）。浮動小数点は要件に応じて。
* 文字 (Characters)
* 文字列 (Strings)


* **リスト (Lists):**
* コンスセル (Cons cells) によるリスト構造。


* **配列 (Arrays/Vectors):** シンプルな1次元配列。

### 2.3 マクロシステム (Macros)

* 言語拡張の要となる機能。
* コード（リスト構造）を引数にとり、展開後のコードを返す関数（マクロ）を定義・利用できる仕組み。
* *Note:* 複雑な分割コンパイル環境などは考慮せず、読み込み時/評価時に展開される単純なモデルとする。

### 2.4 オブジェクト指向サポート (Basic OO Support)

引用にある「非常に基礎的なオブジェクト指向のサポート」として以下を含める。

* **構造体 (Structures):** `defstruct` に相当する機能。
* ユーザー定義のデータ型作成。
* スロット（メンバ変数）へのアクセス。


* **型システム:** 実行時の型判定（`typep` 相当）と、それに基づく単純なディスパッチの基礎。
* *Note:* 完全なCLOS（クラス継承、メソッド結合、多重ディスパッチ）は**第4レイヤー**まで持ち越すため、ここでは実装しない。



## 3. 除外・延期事項 (Excluded Features)

以下の機能は意図的に**第2レイヤー以降**へ延期する。

* **多値 (Multiple Values):** `values`, `multiple-value-bind` 等は実装しない。
* **高度なCLOS:** `defclass`, `defmethod`, `defgeneric`, メソッドコンビネーション等。
* **複雑なI/O:** `format` 関数やストリームの詳細制御（これらは第3レイヤー）。
* **動的再定義機能:** 実行中のクラス変更や関数再定義のフックなど。

## 4. 提供すべきプリミティブ関数群 (Minimal Primitives)

カーネルとして最低限必要な関数セット（例）：

* `car`, `cdr`, `cons`
* `eq` (または `eql`)
* `atom`, `symbolp`, `numberp` 等の述語
* `setq` (または `setf` の基礎)
* `lambda` (関数の作成)
* 四則演算 (`+`, `-`, `*`, `/`) の基礎
